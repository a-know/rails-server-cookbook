upstream <%= node.nginx_settings.application_name %> {
  server unix:/tmp/<%= node.nginx_settings.application_name %>.sock;
}

server {
  listen   80;
  server_name  <%= node.nginx_settings.server_name %>;

  root /var/www/<%= node.nginx_settings.application_name %>/current/public;
  access_log  /var/log/nginx/<%= node.nginx_settings.server_name %>.access.log;
  error_log  /var/log/nginx/<%= node.nginx_settings.server_name %>.error.log;
  client_max_body_size 10m;

  try_files $uri/index.html $uri @app;

  location @app {
    proxy_set_header X-Real-IP X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect   off;
    proxy_pass http://<%= node.nginx_settings.application_name %>;
  }
}
